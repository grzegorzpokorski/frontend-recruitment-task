"use strict";const sections=document.querySelectorAll("section.section-with-image"),endpoint="https://jsonplaceholder.typicode.com/users",createModal=async(e,t)=>{const a=document.createElement("aside"),n=(a.classList.value="modal",a.setAttribute("role","dialog"),a.setAttribute("aria-labelledby",t+"-title"),a.setAttribute("aria-describedby",t+"-describe"),a.setAttribute("aria-modal","true"),document.createElement("section")),o=(n.classList.value="header modal__content",document.createElement("button")),d=(o.classList.value="modal__close",o.dataset.name="closeButton",o.ariaLabel="Close popup",document.createElement("span")),r=(d.classList.value="modal__close__icon",d.setAttribute("aria-hidden","true"),document.createElement("h2")),l=(r.classList.value="modal__title",r.innerText="Alert",r.setAttribute("id",t+"-title"),document.createElement("p"));if(l.innerHTML=`You have clicked <strong>${e.value} times</strong> to related button.`,l.setAttribute("id",t+"-describe"),o.appendChild(d),n.appendChild(o),n.appendChild(r),n.appendChild(l),5<e.value){const s=document.createElement("button");s.classList.value="button button--red",s.dataset.name="resetButton",s.innerHTML="Reset counter",n.appendChild(s)}t=createLoader(),document.body.appendChild(t),e=await getData(endpoint);if(e){e=createTable(e);n.appendChild(e)}else{const c=document.createElement("p");c.classList.add("error"),c.innerText="data loading error",n.appendChild(c)}return document.body.removeChild(t),a.appendChild(n),a},handleCloseModal=({target:e},t)=>{var a=t.querySelector('[data-name="closeButton"]');if(e===t||e===a)removeModal(t);else do{if(e===a)return void removeModal(t)}while(null!=(e=e.parentNode))},handleEscapeKeyPress=({key:e})=>{"Escape"===e&&removeModal(document.querySelector('[role="dialog"]'))},removeModal=e=>{e.remove(),window.removeEventListener("keydown",handleEscapeKeyPress)},getCounter=e=>localStorage.getItem(e)?{id:e,value:parseInt(localStorage.getItem(e))}:{id:e,value:0},incrementCounter=({id:e,value:t})=>{localStorage.setItem(e,t+1)},resetCounter=e=>{localStorage.setItem(e,0)},openModal=async(t,a,e=!0)=>{const n=document.querySelectorAll('[role="dialog"]'),o=(n&&n.forEach(e=>removeModal(e)),e&&incrementCounter(getCounter(a)),await createModal(getCounter(a),a));t.appendChild(o),o.querySelector("button").focus(),o.addEventListener("click",e=>handleCloseModal(e,o)),window.addEventListener("keydown",handleEscapeKeyPress),o.addEventListener("click",({target:e})=>{e===o.querySelector('[data-name="resetButton"]')&&(resetCounter(a),removeModal(o),openModal(t,a,!1))})},initModals=e=>{e.forEach((e,t)=>{const a="swi"+t,n=(e.dataset.name=a,e.querySelector('[data-name="openButton"]'));n.addEventListener("click",()=>openModal(e,a))})},createTable=e=>{const t=document.createElement("div"),a=(t.classList.value="modal__table-wrapper",document.createElement("table")),n=document.createElement("tr");n.innerHTML="<td>imie i nazwisko</td><td>email</td><td>adres</td><td>telefon</td><td>nazwa firmy</td>",a.appendChild(n);return e.forEach(e=>{a.appendChild((e=>{const a=document.createElement("tr"),t=[e.name,e.email,e.address.city+", "+e.address.street+", "+e.address.suite,e.phone,e.company.name];return t.forEach(e=>{const t=document.createElement("td");t.innerText=e,a.appendChild(t)}),a})(e))}),t.appendChild(a),t},getData=async e=>fetch(e).then(e=>e.json()).catch(e=>!1),createLoader=()=>{const e=document.createElement("div"),t=(e.classList.value="loader",e.setAttribute("aria-hidden","true"),document.createElement("span"));return t.classList.value="loader__spinner",e.appendChild(t),e};initModals(sections);